<!DOCTYPE html>
<html lang="sv">
	<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
         <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
                <script type="text/javascript" src="scan.js"></script>
                <link rel="stylesheet" href="https://serratus.github.io/quaggaJS/stylesheets/example.css" >

        <title> Barcoode </title>
	</head>
    <body>
		<div id="sitewrapper"> <!-- Så kan göra anrop från css -->
			
		
			<header id="siteheader"> <!-- Så kan göra anrop från css -->
				<a href="index.html">Koppla stöldskyddsnummer</a>
			</header>
		
			<div id="sitecontent"> <!--  Så kan göra anrop från css -->
				<h1> Scanna </h1>
			
                <!-- Formulär och Css-->
                <div class="row">
                    <div class="col-lg-6">
                        <div class="input-group">
                            <input id="scanner_input" class="form-control" placeholder="Click the button to scan an EAN..." type="text" /> 
                            <span class="input-group-btn"> 
                                <button class="btn btn-default" type="button" data-toggle="modal" data-target="#livestream_scanner">
                                    <i class="fa fa-barcode">Scan</i>
                                </button> 
                            </span>
                        </div><!-- /input-group -->
                    </div><!-- /.col-lg-6 -->
                </div><!-- /.row -->
                <div class="modal" id="livestream_scanner">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <h4 class="modal-title">Barcode Scanner</h4>
                            </div>
                            <div class="modal-body" style="position: static">
                                <div id="interactive" class="viewport"></div>
                                <div class="error"></div>
                            </div>
                            <div class="modal-footer">
                                <label class="btn btn-default pull-left">
                                    <i class="fa fa-camera"></i> Use camera app
                                    <input type="file" accept="image/*;capture=camera" capture="camera" class="hidden" />
                                </label>
                                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
                <!-- Slut fomrulär och css-->
            
                <!-- Variant 2-->
                <link rel="stylesheet" href="https://serratus.github.io/quaggaJS/v1.0.0-beta.1/examples/multiple/styles.css">
                <section id="container" class="container">
                        <h3>Scanna Flera streckkoder</h3>

                        <div class="controls">
                            <button type="button" class="icon-barcode button scan">Start Scanning</button>
                            <div class="readers">
                                <label>
                                    <span>EAN-13</span>
                                    <input type="checkbox" checked="" name="ean_reader">
                                </label>
                            </div>
                        </div>
                        <div class="overlay overlay--inline">
                            <div class="overlay__content">
                                <div class="overlay__close">X</div>
                                <ul class="results"></ul>
                            <video autoplay="true" preload="auto" src=""></video></div>
                        </div>
                </section>
                <script src="index.js" type="text/javascript"></script>
                <!-- Variant 2-->

			</div>
			
			<div id="sitefooter">
				Netgain
            </div>

		</div>

         <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

        <!-- Quagga-->
        <script type="text/javascript" src="node_modules/quagga/dist/quagga.min.js"></script>
        <style>
            #interactive.viewport {position: relative; width: 100%; height: auto; overflow: hidden; text-align: center;}
            #interactive.viewport > canvas, #interactive.viewport > video {max-width: 100%;width: 100%;}
            canvas.drawing, canvas.drawingBuffer {position: absolute; left: 0; top: 0;}
        </style>
        <script type="text/javascript">
        $(function() {
            // Create the QuaggaJS config object for the live stream
            var liveStreamConfig = {
                    inputStream: {
                        type : "LiveStream",
                        constraints: {
                            width: {min: 640},
                            height: {min: 480},
                            aspectRatio: {min: 1, max: 100},
                            facingMode: "environment" // or "user" for the front camera
                        }
                    },
                    locator: {
                        patchSize: "medium",
                        halfSample: true
                    },
                    numOfWorkers: (navigator.hardwareConcurrency ? navigator.hardwareConcurrency : 4),
                    decoder: {
                        "readers":[
                            {"format":"ean_reader","config":{}}
                        ]
                    },
                    locate: true
                };
            // The fallback to the file API requires a different inputStream option. 
            // The rest is the same 
            var fileConfig = $.extend(
                    {}, 
                    liveStreamConfig,
                    {
                        inputStream: {
                            size: 800
                        }
                    }
                );
            // Start the live stream scanner when the modal opens
            $('#livestream_scanner').on('shown.bs.modal', function (e) {
                Quagga.init(
                    liveStreamConfig, 
                    function(err) {
                        if (err) {
                            $('#livestream_scanner .modal-body .error').html('<div class="alert alert-danger"><strong><i class="fa fa-exclamation-triangle"></i> '+err.name+'</strong>: '+err.message+'</div>');
                            Quagga.stop();
                            return;
                        }
                        Quagga.start();
                    }
                );
            });
            
            // Make sure, QuaggaJS draws frames an lines around possible 
            // barcodes on the live stream
            Quagga.onProcessed(function(result) {
                var drawingCtx = Quagga.canvas.ctx.overlay,
                    drawingCanvas = Quagga.canvas.dom.overlay;
        
                if (result) {
                    if (result.boxes) {
                        drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute("width")), parseInt(drawingCanvas.getAttribute("height")));
                        result.boxes.filter(function (box) {
                            return box !== result.box;
                        }).forEach(function (box) {
                            Quagga.ImageDebug.drawPath(box, {x: 0, y: 1}, drawingCtx, {color: "green", lineWidth: 2});
                        });
                    }
        
                    if (result.box) {
                        Quagga.ImageDebug.drawPath(result.box, {x: 0, y: 1}, drawingCtx, {color: "#00F", lineWidth: 2});
                    }
        
                    if (result.codeResult && result.codeResult.code) {
                        Quagga.ImageDebug.drawPath(result.line, {x: 'x', y: 'y'}, drawingCtx, {color: 'red', lineWidth: 3});
                    }
                }
            });
            
            // Once a barcode had been read successfully, stop quagga and 
            // close the modal after a second to let the user notice where 
            // the barcode had actually been found.
            Quagga.onDetected(function(result) {    		
                if (result.codeResult.code){
                    $('#scanner_input').val(result.codeResult.code);
                    Quagga.stop();	
                    setTimeout(function(){ $('#livestream_scanner').modal('hide'); }, 1000);			
                }
            });
            
            // Stop quagga in any case, when the modal is closed
            $('#livestream_scanner').on('hide.bs.modal', function(){
                if (Quagga){
                    Quagga.stop();	
                }
            });
            
            // Call Quagga.decodeSingle() for every file selected in the 
            // file input
            $("#livestream_scanner input:file").on("change", function(e) {
                if (e.target.files && e.target.files.length) {
                    Quagga.decodeSingle($.extend({}, fileConfig, {src: URL.createObjectURL(e.target.files[0])}), function(result) {alert(result.codeResult.code);});
                }
            });
        });
        </script>

  
        

	</body>
	
</html>